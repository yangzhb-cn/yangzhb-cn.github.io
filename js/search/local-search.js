function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,r,o,l=[],s=!0,c=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(a=r.call(n)).done)&&(l.push(a.value),l.length!==t);s=!0);}catch(e){c=!0,i=e}finally{try{if(!s&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var n,a,i,r,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(o)return i=!(a=!0),{s:function(){o=o.call(e)},n:function(){var e=o.next();return a=e.done,e},e:function(e){i=!0,n=e},f:function(){try{a||null==o.return||o.return()}finally{if(i)throw n}}};if(Array.isArray(e)||(o=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,_toPropertyKey(a.key),a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var LocalSearch=(()=>_createClass(function e(t){var n=t.path,n=void 0===n?"":n,a=t.unescape,a=void 0!==a&&a,t=t.top_n_per_article,t=void 0===t?1:t;_classCallCheck(this,e),this.path=n,this.unescape=a,this.top_n_per_article=t,this.isfetched=!1,this.datas=null},[{key:"getIndexByWord",value:function(e,r){var o=this,l=2<arguments.length&&void 0!==arguments[2]&&arguments[2],s=[],c=new Set;return l||(r=r.toLowerCase()),e.forEach(function(e){o.unescape&&((t=document.createElement("div")).innerText=e,e=t.innerHTML);var t,n=e.length;if(0!==n){var a,i=0;for(l||(e=e.toLowerCase());-1<(a=r.indexOf(e,i));)s.push({position:a,word:e}),c.add(e),i=a+n}}),s.sort(function(e,t){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length}),[s,c]}},{key:"mergeIntoSlice",value:function(e,t,n){for(var a=n[0],i=a.position,r=a.word,o=[],l=new Set;i+r.length<=t&&0!==n.length;){l.add(r),o.push({position:i,length:r.length});var s=i+r.length;for(n.shift();0!==n.length&&(i=(a=n[0]).position,r=a.word,i<s);)n.shift()}return{hits:o,start:e,end:t,count:l.size}}},{key:"highlightKeyword",value:function(e,t){var n,a="",i=t.start,r=_createForOfIteratorHelper(t.hits);try{for(r.s();!(n=r.n()).done;){var o=n.value,l=o.position,s=o.length;a+=e.substring(i,l),i=l+s,a+='<mark class="search-keyword">'.concat(e.substr(l,s),"</mark>")}}catch(e){r.e(e)}finally{r.f()}return a+=e.substring(i,t.end)}},{key:"getResultItems",value:function(h){var f=this,g=[];return this.datas.forEach(function(e){var t=e.title,n=e.content,e=e.url,a=_slicedToArray(f.getIndexByWord(h,t),2),i=a[0],a=a[1],r=_slicedToArray(f.getIndexByWord(h,n),2),o=r[0],r=r[1],a=new Set([].concat(_toConsumableArray(a),_toConsumableArray(r))).size,r=i.length+o.length;if(0!==r){for(var l=[],s=(0!==i.length&&l.push(f.mergeIntoSlice(0,t.length,i)),[]);0!==o.length;){var c=o[0].position,u=Math.max(0,c-20),c=Math.min(n.length,c+100);s.push(f.mergeIntoSlice(u,c,o))}s.sort(function(e,t){return e.count!==t.count?t.count-e.count:e.hits.length!==t.hits.length?t.hits.length-e.hits.length:e.start-t.start});var i=parseInt(f.top_n_per_article,10),d=(0<=i&&(s=s.slice(0,i)),"");(e=new URL(e,location.origin)).searchParams.append("highlight",h.join(" ")),d+=0!==l.length?'<li class="local-search-hit-item"><a href="'.concat(e.href,'"><span class="search-result-title">').concat(f.highlightKeyword(t,l[0]),"</span>"):'<li class="local-search-hit-item"><a href="'.concat(e.href,'"><span class="search-result-title">').concat(t,"</span>"),s.forEach(function(e){d+='<p class="search-result">'.concat(f.highlightKeyword(n,e),"...</p>")}),d+="</a></li>",g.push({item:d,id:g.length,hitCount:r,includedCount:a})}}),g}},{key:"fetchData",value:function(){var t=this,n=!this.path.endsWith("json");fetch(this.path).then(function(e){return e.text()}).then(function(e){t.isfetched=!0,t.datas=n?_toConsumableArray((new DOMParser).parseFromString(e,"text/xml").querySelectorAll("entry")).map(function(e){return{title:e.querySelector("title").textContent,content:e.querySelector("content").textContent,url:e.querySelector("url").textContent}}):JSON.parse(e),t.datas=t.datas.filter(function(e){return e.title}).map(function(e){return e.title=e.title.trim(),e.content=e.content?e.content.trim().replace(/<[^>]+>/g,""):"",e.url=decodeURIComponent(e.url).replace(/\/{2,}/g,"/"),e}),window.dispatchEvent(new Event("search:loaded"))})}},{key:"highlightText",value:function(t,e,n){var a,i=t.nodeValue,r=e.start,o=[],l=_createForOfIteratorHelper(e.hits);try{for(l.s();!(a=l.n()).done;){var s=a.value,c=s.position,u=s.length,d=document.createTextNode(i.substring(r,c)),r=c+u,h=document.createElement("mark");h.className=n,h.appendChild(document.createTextNode(i.substr(c,u))),o.push(d,h)}}catch(e){l.e(e)}finally{l.f()}t.nodeValue=i.substring(r,e.end),o.forEach(function(e){t.parentNode.insertBefore(e,t)})}},{key:"highlightSearchWords",value:function(e){var n=this,t=new URL(location.href).searchParams.get("highlight"),a=t?t.split(" "):[];if(a.length&&e){for(var i=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),r=[];i.nextNode();)i.currentNode.parentNode.matches("button, select, textarea, .mermaid")||r.push(i.currentNode);r.forEach(function(e){var t=_slicedToArray(n.getIndexByWord(a,e.nodeValue),1)[0];t.length&&(t=n.mergeIntoSlice(0,e.nodeValue.length,t),n.highlightText(e,t,"search-keyword"))})}}}]))();window.addEventListener("load",function(){function e(){btf.overflowPaddingR.add(),btf.animateIn(S,"to_show 0.5s"),btf.animateIn(I,"titleScale 0.5s"),setTimeout(function(){s.focus()},300),P||(l.isfetched||l.fetchData(),s.addEventListener("input",w),P=!0),document.addEventListener("keydown",function e(t){"Escape"===t.code&&(E(),document.removeEventListener("keydown",e))}),k(),window.addEventListener("resize",k)}function t(){btf.addEventListenerPjax(document.querySelector("#search-button > .search"),"click",e)}var n=GLOBAL_CONFIG.localSearch,a=n.path,i=n.languages,r=n.pagination,o=r&&r.enable,l=new LocalSearch({path:a,top_n_per_article:n.top_n_per_article,unescape:n.unescape}),s=document.querySelector(".local-search-input input"),c=document.getElementById("local-search-stats"),u=document.getElementById("loading-status"),d=!a.endsWith("json"),h=0,f=r.hitsPerPage||10,g=[],p=(o||(g=h=void 0),{get pagination(){return document.getElementById("local-search-pagination")},get paginationList(){return document.querySelector("#local-search-pagination .ais-Pagination-list")}}),m=function(e){p.pagination.style.display=o&&e?"":"none"},y=function(e,t){var n=document.getElementById("local-search-results"),a=o?g.slice(h*f,(h+1)*f):t;o&&0===a.length&&0<g.length?(h=0,y(e,t)):(a=a.map(function(e,t){t=o?h*f+t+1:t+1;return e.item.replace('<li class="local-search-hit-item">','<li class="local-search-hit-item" value="'.concat(t,'">'))}),n.innerHTML='<ol class="search-result-list">'.concat(a.join(""),"</ol>"),a=(o?g:t).length,a=i.hits_stats.replace(/\$\{hits}/,a),c.innerHTML='<hr><div class="search-result-stats">'.concat(a,"</div>"),o&&(a=Math.ceil(g.length/f),v(h,a,e)),a=0<t.length,m(a),window.pjax&&window.pjax.refresh(n))},v=function(e,t,n){if(t<=1)p.pagination.style.display="none",p.paginationList.innerHTML="";else{p.pagination.style.display="block";var a=0===e,i=e===t-1,r=window.innerWidth<768?3:5,o=Math.max(0,e-Math.floor(r/2)),l=Math.min(t-1,o+r-1),s=(l-o+1<r&&(o=Math.max(0,l-r+1)),"");r<t&&0<o&&(s+='\n        <li class="ais-Pagination-item ais-Pagination-item--page">\n          <a class="ais-Pagination-link" aria-label="Page 1" href="#" data-page="0">1</a>\n        </li>',1<o)&&(s+='\n          <li class="ais-Pagination-item ais-Pagination-item--ellipsis">\n            <span class="ais-Pagination-link">...</span>\n          </li>');for(var c=o;c<=l;c++)s+=c===e?'\n          <li class="ais-Pagination-item ais-Pagination-item--page ais-Pagination-item--selected">\n            <span class="ais-Pagination-link" aria-label="Page '.concat(c+1,'">').concat(c+1,"</span>\n          </li>"):'\n          <li class="ais-Pagination-item ais-Pagination-item--page">\n            <a class="ais-Pagination-link" aria-label="Page '.concat(c+1,'" href="#" data-page="').concat(c,'">').concat(c+1,"</a>\n          </li>");r<t&&l<t-1&&(l<t-2&&(s+='\n          <li class="ais-Pagination-item ais-Pagination-item--ellipsis">\n            <span class="ais-Pagination-link">...</span>\n          </li>'),s+='\n        <li class="ais-Pagination-item ais-Pagination-item--page">\n          <a class="ais-Pagination-link" aria-label="Page '.concat(t,'" href="#" data-page="').concat(t-1,'">').concat(t,"</a>\n        </li>")),1<t?p.paginationList.innerHTML='\n            <li class="ais-Pagination-item ais-Pagination-item--previousPage '.concat(a?"ais-Pagination-item--disabled":"",'">\n              ').concat(a?'<span class="ais-Pagination-link ais-Pagination-link--disabled" aria-label="Previous Page"><i class="fas fa-angle-left"></i></span>':'<a class="ais-Pagination-link" aria-label="Previous Page" href="#" data-page="'.concat(e-1,'"><i class="fas fa-angle-left"></i></a>'),"\n            </li>\n            ").concat(s,'\n            <li class="ais-Pagination-item ais-Pagination-item--nextPage ').concat(i?"ais-Pagination-item--disabled":"",'">\n              ').concat(i?'<span class="ais-Pagination-link ais-Pagination-link--disabled" aria-label="Next Page"><i class="fas fa-angle-right"></i></span>':'<a class="ais-Pagination-link" aria-label="Next Page" href="#" data-page="'.concat(e+1,'"><i class="fas fa-angle-right"></i></a>'),"\n            </li>"):p.pagination.style.display="none"}},b=function(){document.getElementById("local-search-results").textContent="",c.textContent="",m(!1),o&&(g=[],h=0)},_=function(e){document.getElementById("local-search-results").textContent="";var t=document.createElement("div");t.className="search-result-stats",t.textContent=i.hits_empty.replace(/\$\{query}/,e),c.innerHTML=t.outerHTML,m(!1),o&&(g=[],h=0)},w=function(){var e,t,n;l.isfetched&&(e=s.value.trim().toLowerCase(),""!==(e=d?e.replace(/</g,"&lt;").replace(/>/g,"&gt;"):e)&&(u.hidden=!1),t=e.split(/[-\s]+/),n=[],0<e.length&&(n=l.getResultItems(t)),1===t.length&&""===t[0]?b():0===n.length?_(e):(n.sort(function(e,t){return e.includedCount!==t.includedCount?t.includedCount-e.includedCount:e.hitCount!==t.hitCount?t.hitCount-e.hitCount:t.id-e.id}),o&&(g=n,h=0),y(e,n)),u.hidden=!0)},P=!1,S=document.getElementById("search-mask"),I=document.querySelector("#local-search .search-dialog"),k=function(){window.innerWidth<768&&I.style.setProperty("--search-height",window.innerHeight+"px")},E=function(){btf.overflowPaddingR.remove(),btf.animateOut(I,"search_close .5s"),btf.animateOut(S,"to_hide 0.5s"),window.removeEventListener("resize",k)};window.addEventListener("search:loaded",function(){var e=document.getElementById("loading-database");e.nextElementSibling.style.visibility="visible",e.remove()}),t(),document.querySelector("#local-search .search-close-button").addEventListener("click",E),S.addEventListener("click",E),GLOBAL_CONFIG.localSearch.preload&&l.fetchData(),l.highlightSearchWords(document.getElementById("article-container")),o&&p.pagination.addEventListener("click",function(e){e.preventDefault();var e=e.target.closest("a[data-page]");e&&(e=parseInt(e.dataset.page,10),!isNaN(e))&&0<g.length&&(h=e,y(s.value.trim().toLowerCase(),g))}),m(!1),window.addEventListener("pjax:complete",function(){btf.isHidden(S)||E(),l.highlightSearchWords(document.getElementById("article-container")),t()})});